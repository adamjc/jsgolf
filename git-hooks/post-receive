# DIR SETUP
echo "Setting up folder structure..."
if [ -d /var/jsgolf ]; then
  sudo mkdir -p /var/jsgolf
  sudo git clone /git /var/jsgolf
fi

cd /var/jsgolf
echo $(pwd)
git pull --rebase
cp git-hooks/post-recieve /git/hooks/

# NGINX SETUP
echo "Setting up NGINX..."
which nginx
if [ $? != 0 ]; then
  apt-get install -y nginx
fi

cp nginx.conf /etc/nginx/conf

if [ -d /etc/systemd/system/nginx.service.d ]; then
  mkdir -p /etc/systemd/system/nginx.service.d
  mv restart-nginx.conf /etc/systemd/system/nginx.service.d/override.conf
fi

# APP SETUP
echo "Setting up jsgolf..."

sudo apt install -y npm
sudo npm install -g npm@latest
sudo npm install
npx gulp

which pm2
if [ $? != 0 ]; then
  npm install -g pm2
  pm2 start app.js
fi

pm2 restart


